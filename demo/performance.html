<html><head>
<title>JITD Performance</title>

<script type="text/javascript" src="d3.min.js"></script>

<style>
.chart {
  position: relative;
  margin: auto;
  width: 100%;
  height: 95%;
  vertical-align: bottom;
  background-color: lightgrey;
}
.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}
</style>

<script>
function plot(data) {
  var chart = d3.select(".chart")
  
  var barWidth = 30;
  var height = chart.property("clientHeight");
  var width = chart.property("clientWidth");
  
  var y = d3.scale.linear()
            .domain([0, d3.max(data, function(d) { return d.v * 1; } )])
            .range([0, height])
    
  var start = ((width - data.length * barWidth)/2);
  
  chart.text("");
  
  var bar = chart.selectAll("g")
              .data(data)
              .enter().append("g")
                .attr("transform", function(d, i) { 
                                      return "translate("+(start + i*barWidth)+",0)";
                                   });
  
  bar.append("rect")
        .attr("y", function(d) { return height-y(d.v); })
        .attr("width", barWidth - 1)
        .attr("height", function(d) { return y(d.v); })
        .attr("fill", function(d) {
            if(d.t == "read"){
              return "steelblue";
            } else {
              return "#555";
            }
          });
  
  bar.append("text")
        .attr("x", barWidth / 2)
        .attr("y", height - 5)
        .attr("dx", ".4em")
        .text(function(d) { return d.v; });
  
}

function reloadTimings(){
  d3.json("http://localhost:8010/perf", function(err, result){
    if(err == null){
      if(result.status == "success"){
        plot(result.data);
      } else {
        console.log(err.msg);
      }
      window.setTimeout(reloadTimings, 1000);
    } else {
      console.log(err);
      window.setTimeout(reloadTimings, 5000);
    }
  });
}
</script>

</head><body onload="reloadTimings()">

<svg class="chart"></svg>


</body></html>